<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Recipe Creation Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #333;
    }
    .test-result {
      margin: 10px 0;
      padding: 10px;
      border-radius: 4px;
    }
    .pass {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .fail {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    button {
      background-color: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background-color: #45a049;
    }
    .recipe-card {
      background-color: #f8f9fa;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      border-left: 4px solid #4CAF50;
    }
    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0,0,0,.3);
      border-radius: 50%;
      border-top-color: #4CAF50;
      animation: spin 1s ease-in-out infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Recipe Creation Test</h1>
    <p>This page tests the recipe creation functionality.</p>
    
    <button onclick="runTests()">Run Tests</button>
    
    <div id="test-results" style="margin-top: 20px;"></div>
    
    <div id="recipes-list" style="margin-top: 20px;"></div>
  </div>

  <script type="module">
    // Import test data
    import { testRecipes, recipeCreationPayloads, recipeTestCases } from './recipe-test-data.js';

    // Recipe Test Script
    class RecipeTestScript {
      constructor() {
        this.recipes = [];
        this.testResults = [];
      }

      async runAllTests() {
        const resultsDiv = document.getElementById('test-results');
        const recipesDiv = document.getElementById('recipes-list');
        
        resultsDiv.innerHTML = '<h2>Test Results</h2><div class="loading"></div>';
        recipesDiv.innerHTML = '';

        // Test 1: Create recipes from test cases
        await this.testCreateRecipes();

        // Test 2: Verify recipe data integrity
        this.testRecipeDataIntegrity();

        // Test 3: Test recipe filtering by status
        this.testRecipeFiltering();

        // Test 4: Test recipe search functionality
        this.testRecipeSearch();

        // Display test results
        this.displayTestResults(resultsDiv);

        // Display created recipes
        this.displayRecipes(recipesDiv);
      }

      async testCreateRecipes() {
        console.log('Test 1: Creating recipes...');

        for (const testCase of recipeTestCases) {
          console.log(`  Creating: ${testCase.name}`);
          
          try {
            // Simulate API call to create recipe
            const newRecipe = await this.simulateCreateRecipe(testCase.payload, testCase.expectedStatus);
            this.recipes.push(newRecipe);
            
            this.testResults.push({
              test: `Create ${testCase.name}`,
              status: 'PASS',
              message: `Successfully created recipe: ${newRecipe.name}`
            });
          } catch (error) {
            this.testResults.push({
              test: `Create ${testCase.name}`,
              status: 'FAIL',
              message: `Failed to create recipe: ${error.message}`
            });
          }
        }

        console.log(`  Created ${this.recipes.length} recipes`);
      }

      testRecipeDataIntegrity() {
        console.log('Test 2: Verifying recipe data integrity...');

        let allValid = true;

        for (const recipe of this.recipes) {
          // Check required fields
          const hasRequiredFields = recipe.name && recipe.ingredients && recipe.ingredients.length > 0;
          
          if (!hasRequiredFields) {
            allValid = false;
            this.testResults.push({
              test: `Verify ${recipe.name} data`,
              status: 'FAIL',
              message: 'Missing required fields'
            });
          } else {
            this.testResults.push({
              test: `Verify ${recipe.name} data`,
              status: 'PASS',
              message: 'All required fields present'
            });
          }
        }

        console.log(`  Data integrity check: ${allValid ? 'PASS' : 'FAIL'}`);
      }

      testRecipeFiltering() {
        console.log('Test 3: Testing recipe filtering...');

        // Test filtering by status
        const statuses = ['public', 'private', 'draft'];
        
        for (const status of statuses) {
          const filteredRecipes = this.recipes.filter(recipe => recipe.status === status);
          console.log(`  ${status}: ${filteredRecipes.length} recipes`);
          
          this.testResults.push({
            test: `Filter recipes by ${status}`,
            status: 'PASS',
            message: `Found ${filteredRecipes.length} recipes with ${status} status`
          });
        }
      }

      testRecipeSearch() {
        console.log('Test 4: Testing recipe search...');

        const searchTerms = ['pizza', 'salad', 'stir', 'burger'];
        
        for (const term of searchTerms) {
          const searchResults = this.recipes.filter(recipe => 
            recipe.name.toLowerCase().includes(term.toLowerCase()) ||
            recipe.ingredients.some(ingredient => 
              ingredient.toLowerCase().includes(term.toLowerCase())
            )
          );
          
          console.log(`  Search for "${term}": ${searchResults.length} results`);
          
          this.testResults.push({
            test: `Search for "${term}"`,
            status: 'PASS',
            message: `Found ${searchResults.length} recipes matching "${term}"`
          });
        }
      }

      async simulateCreateRecipe(recipeData, status) {
        // Simulate API delay
        await new Promise(resolve => setTimeout(resolve, 500));

        // Create new recipe object
        const newRecipe = {
          id: Date.now() + Math.floor(Math.random() * 1000),
          ...recipeData,
          status: status,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };

        return newRecipe;
      }

      displayTestResults(container) {
        let html = '<h2>Test Results</h2>';
        
        const passCount = this.testResults.filter(result => result.status === 'PASS').length;
        const failCount = this.testResults.filter(result => result.status === 'FAIL').length;
        
        html += `<p>Total Tests: ${this.testResults.length} | Passed: ${passCount} | Failed: ${failCount}</p>`;
        
        for (const result of this.testResults) {
          html += `<div class="test-result ${result.status.toLowerCase()}">
            <strong>${result.test}</strong>: ${result.status}<br>
            ${result.message}
          </div>`;
        }
        
        container.innerHTML = html;
      }

      displayRecipes(container) {
        let html = '<h2>Created Recipes</h2>';
        
        if (this.recipes.length === 0) {
          html += '<p>No recipes created yet.</p>';
        } else {
          for (const recipe of this.recipes) {
            html += `<div class="recipe-card">
              <h3>${recipe.name}</h3>
              <p><strong>Status:</strong> ${recipe.status}</p>
              <p><strong>Ingredients:</strong> ${recipe.ingredients.join(', ')}</p>
              <p><strong>Prep Time:</strong> ${recipe.prepTime}, <strong>Cook Time:</strong> ${recipe.cookTime}</p>
              <p><strong>Servings:</strong> ${recipe.servings}</p>
              <p><strong>Instructions:</strong> ${recipe.instructions.replace(/\n/g, '<br>')}</p>
            </div>`;
          }
        }
        
        container.innerHTML = html;
      }
    }

    // Run tests function
    function runTests() {
      const testScript = new RecipeTestScript();
      testScript.runAllTests();
    }
  </script>
</body>
</html>
